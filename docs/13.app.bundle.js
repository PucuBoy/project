"use strict";(self.webpackChunkstory_explorer=self.webpackChunkstory_explorer||[]).push([[13],{13:(e,t,r)=>{r.r(t),r.d(t,{default:()=>s});var n=r(844);const s=class{async render(){return'\n            <div class="stories">\n                <div class="stories-header">\n                    <h1>Favorite Stories</h1>\n                    <nav>\n                        <a href="#/" class="nav-link" aria-label="Back to home">\n                            <i class="fas fa-arrow-left"></i> Back\n                        </a>\n                    </nav>\n                </div>\n                <div id="favoritesList" class="story-list">\n                    <div class="loading-spinner"></div>\n                </div>\n            </div>\n        '}async afterRender(){const e=document.getElementById("favoritesList"),t=await n.A.getFavorites();0!==t.length?(e.innerHTML=t.map((e=>`\n            <article class="story-item">\n                <img class="story-image" src="${e.photoUrl}" alt="${e.description}">\n                <div class="story-content">\n                    <h2>${e.name}</h2>\n                    <p>${e.description}</p>\n                    <time datetime="${e.createdAt}">${new Date(e.createdAt).toLocaleDateString()}</time>\n                    <button class="remove-favorite" data-id="${e.id}">\n                        Remove from Favorites\n                    </button>\n                </div>\n            </article>\n        `)).join(""),this._initializeEventListeners(e)):e.innerHTML='\n                <div class="end-message">\n                    <p>No favorite stories yet</p>\n                </div>\n            '}_initializeEventListeners(e){e.addEventListener("click",(async t=>{if(t.target.classList.contains("remove-favorite")){const r=t.target.dataset.id;await n.A.removeFromFavorites(r),t.target.closest(".story-item").remove(),0===e.children.length&&(e.innerHTML='\n                        <div class="end-message">\n                            <p>No favorite stories yet</p>\n                        </div>\n                    ')}}))}}},115:(e,t,r)=>{r.d(t,{A:()=>n});const n={BASE_URL:"https://story-api.dicoding.dev/v1",VAPID_PUBLIC_KEY:"BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk",DEFAULT_MAP_CENTER:{lat:-6.2,lon:106.816666},MAP_OPTIONS:{DEFAULT_ZOOM:5,TILE_LAYER:{DEFAULT:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",SATELLITE:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"}}}},628:(e,t,r)=>{r.d(t,{A:()=>i}),r(115);const n="stories",s="offline-stories",o=()=>new Promise(((e,t)=>{const r=indexedDB.open("story-explorer-db",1);r.onerror=()=>{t(r.error)},r.onsuccess=()=>{e(r.result)},r.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(n)||t.createObjectStore(n,{keyPath:"id"}).createIndex("createdAt","createdAt",{unique:!1}),t.objectStoreNames.contains(s)||t.createObjectStore(s,{keyPath:"id",autoIncrement:!0}).createIndex("timestamp","timestamp",{unique:!1})}})),i={async getStories(){try{const e=await o();return new Promise(((t,r)=>{const s=e.transaction(n,"readonly").objectStore(n).getAll();s.onsuccess=()=>t(s.result),s.onerror=()=>r(s.error)}))}catch(e){return console.error("Error getting stories:",e),[]}},async saveStories(e){try{const t=(await o()).transaction(n,"readwrite").objectStore(n);return await Promise.all(e.map((e=>new Promise(((r,n)=>{const s=t.put({...e,timestamp:(new Date).getTime()});s.onsuccess=()=>r(),s.onerror=()=>n(s.error)}))))),!0}catch(e){return console.error("Error saving stories:",e),!1}},async saveOfflineStory(e){try{const t=(await o()).transaction(s,"readwrite").objectStore(s);return new Promise(((r,n)=>{const s=t.add({...e,timestamp:(new Date).getTime(),synced:!1});s.onsuccess=()=>r(!0),s.onerror=()=>n(s.error)}))}catch(e){return console.error("Error saving offline story:",e),!1}},async getOfflineStories(){try{const e=(await o()).transaction(s,"readonly").objectStore(s);return new Promise(((t,r)=>{const n=e.getAll();n.onsuccess=()=>t(n.result),n.onerror=()=>r(n.error)}))}catch(e){return console.error("Error getting offline stories:",e),[]}},async deleteStory(e){try{const t=(await o()).transaction(n,"readwrite").objectStore(n);return new Promise(((r,n)=>{const s=t.delete(e);s.onsuccess=()=>r(!0),s.onerror=()=>n(s.error)}))}catch(e){return console.error("Error deleting story:",e),!1}},async clearOldStories(e=6048e5){try{const t=(await o()).transaction(n,"readwrite").objectStore(n).index("createdAt"),r=(new Date).getTime()-e,s=t.openCursor();return new Promise(((e,t)=>{s.onsuccess=t=>{const n=t.target.result;n?(n.value.timestamp<r&&n.delete(),n.continue()):e(!0)},s.onerror=()=>t(s.error)}))}catch(e){return console.error("Error clearing old stories:",e),!1}}}},844:(e,t,r)=>{r.d(t,{A:()=>E});const n=(e,t)=>t.some((t=>e instanceof t));let s,o;const i=new WeakMap,a=new WeakMap,c=new WeakMap;let d={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return i.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return v(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function l(e){d=e(d)}function u(e){return"function"==typeof e?(t=e,(o||(o=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(m(this),e),v(this.request)}:function(...e){return v(t.apply(m(this),e))}):(e instanceof IDBTransaction&&function(e){if(i.has(e))return;const t=new Promise(((t,r)=>{const n=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",o),e.removeEventListener("abort",o)},s=()=>{t(),n()},o=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",s),e.addEventListener("error",o),e.addEventListener("abort",o)}));i.set(e,t)}(e),n(e,s||(s=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,d):e);var t}function v(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,r)=>{const n=()=>{e.removeEventListener("success",s),e.removeEventListener("error",o)},s=()=>{t(v(e.result)),n()},o=()=>{r(e.error),n()};e.addEventListener("success",s),e.addEventListener("error",o)}));return c.set(t,e),t}(e);if(a.has(e))return a.get(e);const t=u(e);return t!==e&&(a.set(e,t),c.set(t,e)),t}const m=e=>c.get(e),y=["get","getKey","getAll","getAllKeys","count"],p=["put","add","delete","clear"],f=new Map;function g(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(f.get(t))return f.get(t);const r=t.replace(/FromIndex$/,""),n=t!==r,s=p.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!s&&!y.includes(r))return;const o=async function(e,...t){const o=this.transaction(e,s?"readwrite":"readonly");let i=o.store;return n&&(i=i.index(t.shift())),(await Promise.all([i[r](...t),s&&o.done]))[0]};return f.set(t,o),o}l((e=>({...e,get:(t,r,n)=>g(t,r)||e.get(t,r,n),has:(t,r)=>!!g(t,r)||e.has(t,r)})));const w=["continue","continuePrimaryKey","advance"],h={},D=new WeakMap,I=new WeakMap,S={get(e,t){if(!w.includes(t))return e[t];let r=h[t];return r||(r=h[t]=function(...e){D.set(this,I.get(this)[t](...e))}),r}};async function*b(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;const r=new Proxy(t,S);for(I.set(r,t),c.set(r,m(t));t;)yield r,t=await(D.get(r)||t.continue()),D.delete(r)}function B(e,t){return t===Symbol.asyncIterator&&n(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&n(e,[IDBIndex,IDBObjectStore])}l((e=>({...e,get:(t,r,n)=>B(t,r)?b:e.get(t,r,n),has:(t,r)=>B(t,r)||e.has(t,r)}))),r(628);const E=class{static async initDB(){if(!("indexedDB"in window))return console.error("IndexedDB not supported"),null;try{return await function(e,t,{blocked:r,upgrade:n,blocking:s,terminated:o}={}){const i=indexedDB.open(e,t),a=v(i);return n&&i.addEventListener("upgradeneeded",(e=>{n(v(i.result),e.oldVersion,e.newVersion,v(i.transaction),e)})),r&&i.addEventListener("blocked",(e=>r(e.oldVersion,e.newVersion,e))),a.then((e=>{o&&e.addEventListener("close",(()=>o())),s&&e.addEventListener("versionchange",(e=>s(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}("story-explorer-db",2,{upgrade(e,t,r){e.objectStoreNames.contains("stories")||e.createObjectStore("stories",{keyPath:"id"}).createIndex("timestamp","createdAt"),e.objectStoreNames.contains("favorites")||e.createObjectStore("favorites",{keyPath:"id"}).createIndex("timestamp","createdAt")}})}catch(e){return console.error("Error initializing database:",e),null}}static async saveStory(e){const t=await this.initDB();await t.put("stories",e)}static async getStories(){return(await this.initDB()).getAllFromIndex("stories","timestamp")}static async deleteStory(e){const t=await this.initDB();await t.delete("stories",e)}static async addToFavorites(e){const t=await this.initDB();e.isFavorite=!0,await t.put("favorites",e),await this.saveStory(e)}static async removeFromFavorites(e){const t=await this.initDB();await t.delete("favorites",e);const r=await this.getStory(e);r&&(r.isFavorite=!1,await this.saveStory(r))}static async getStory(e){return(await this.initDB()).get("stories",e)}static async getFavorites(){return(await this.initDB()).getAllFromIndex("favorites","timestamp")}static async isFavorite(e){const t=await this.initDB();return!!await t.get("favorites",e)}}}}]);